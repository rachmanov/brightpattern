!function(){var e,n=SERVICE_PATTERN_CHAT_CONFIG||{},t=!1,i=[],o=function(){var e="";return n.location&&(e+="&latitude="+encodeURIComponent(n.location.latitude+""),e+="&longitude="+encodeURIComponent(n.location.longitude+"")),n.chatPath+"client-chat-page.html?tenantUrl="+encodeURIComponent(n.tenantUrl)+"&appId="+n.appId+"&referrer="+encodeURIComponent(window.location.href)+"&webServer="+encodeURIComponent(n.apiUrl)+e+"&phone_number="+encodeURIComponent(n.phone_number||"")+"&from="+encodeURIComponent(n.from||"")+"&email="+encodeURIComponent(n.email||"")+"&account_number="+encodeURIComponent(n.account_number||"")+"&last_name="+encodeURIComponent(n.last_name||"")+"&first_name="+encodeURIComponent(n.first_name||"")},a=function(n,i){if(r())return void window.location.replace(o());s(n);var a=e("#sp-chat-frame"),d=e("#sp-chat-widget"),p=n?a:d,l=n?d:a;if(p.is(":visible"))return void(i&&e("#sp-chat-iframe").remove());if(c(),-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome"))l.hide(),p.toggle();else{p.toggle();var m=p.offset(),h=p.width(),u=p.height();p.toggle();var f=e("#sp-chat-fake");f.height(l.height()).width(l.width()).css(l.offset()),l.hide(),f.toggle(),f.animate({width:h,height:u,right:m.right,top:m.top,left:m.left},400,function(){p.toggle(),f.toggle(),t=!0,i?e("#sp-chat-iframe").remove():document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-dragged","*")})}},s=function(e){e?window.sessionStorage.setItem("sp-chat-snippet","true"):window.sessionStorage.removeItem("sp-chat-snippet")},d=function(){return e("#sp-chat-iframe").length>0},c=function(){if(!d()){e("#sp-chat-frame").css("height","420px");var n='<iframe id="sp-chat-iframe" frameborder="0" scrolling="no" src='+o()+"></iframe>";e("#sp-iframe-container").append(n),e("#sp-chat-frame").draggable({handle:"#sp-drag-handle",start:function(){e("#sp-drag-handle").height("100%")},drag:function(n,t){var i=Math.min(e(window).height()-400,t.position.top),o=Math.min(e(window).width()-SERVICE_PATTERN_CHAT_CONFIG.width-70,t.position.left);t.position.top=Math.max(20,i),t.position.left=Math.max(20,o),document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-dragged","*")},stop:function(){e("#sp-drag-handle").height("20px")}})}},r=function(){var e=!1;return function(n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},p=function(){e("head").append("<link href='"+n.chatPath+"css/snippet.css' type='text/css' rel='stylesheet' />"),e("body").append("<div id='sp-root-container'><div id='sp-chat-widget'> <div id='sp-chat-label-icon'></div><div id='sp-chat-label-text'></div></div><div id='sp-chat-fake'></div><div id='sp-chat-frame'><div id='sp-drag-handle'></div><div id='sp-side-bar'><div id='sp-close-frame'></div></div><div id='sp-iframe-container'></div></div></div>"),e("#sp-close-frame").bind("click",function(){document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-disconnect","*")}),function(){function n(n){var o="sp-hidden",a={blur:o,focusout:o,pagehide:o};n=n||window.event;var s=e("#sp-root-container");if(s.removeClass(o),n.type in a?s.addClass(a[n.type]):this[t]&&s.addClass(o),!s.hasClass(o))for(var d=i.length,c=0;d>c;c++)i[c].close()}var t="hidden",o=function(e){e&&("undefined"!=typeof console&&console.log("Snippet will wrap the site function %o",e),e()),n()};t in document?document.addEventListener("visibilitychange",n):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(t="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?(document.onfocusin=o(document.onfocusin),document.onfocusout=o(document.onfocusout)):(window.onpageshow=o(window.onpageshow),window.onpagehide=o(window.onpagehide),window.onfocus=o(window.onfocus),window.onblur=o(window.onblur)),void 0!==document[t]&&n({type:document[t]?"blur":"focus"})}(),e(window).on("message",function(n){var i=n.originalEvent.data;if("sp-session-end"==i)t?a(!1,!0):window.setTimeout(function(){a(!1,!0)},500);else if("sp-chat-init"==i)e("#sp-drag-handle").height("0px"),e("#sp-chat-frame").height("420px"),e("#sp-chat-frame").css("top","");else if("sp-chat-drag"==i)e("#sp-drag-handle").height("20px"),e("#sp-chat-frame").css("height",""),e("#sp-chat-frame").css("top",Math.max(0,e(window).height()-420)+"px");else if("sp-start-screen-sharing"==i);else if("sp-stop-screen-sharing"==i);else if("sp-session-start"==i)window.Notification&&"denied"!==window.Notification.permission&&(document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-req-notification","*"),window.Notification.requestPermission(function(){document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-req-notification-end","*")}));else if(0==i.indexOf("sp-notification")){var o=i.split(";");l(o[3],o[2],o[1])}}),m()},l=function(n,t,o){if(window.Notification&&"granted"===window.Notification.permission&&e("#sp-root-container").hasClass("sp-hidden")){var a={body:t,icon:o},s=new window.Notification(n,a);i.push(s),s.onclose=function(){var e=i.indexOf(s);e>-1&&i.splice(e,1)},s.onclick=function(){window.focus()}}},m=function(){var n=SERVICE_PATTERN_CHAT_CONFIG.apiUrl+"/availability?tenantUrl="+encodeURIComponent(SERVICE_PATTERN_CHAT_CONFIG.tenantUrl),t={headers:{Authorization:'MOBILE-API-140-327-PLAIN appId="'+SERVICE_PATTERN_CHAT_CONFIG.appId+'", clientId="'+SERVICE_PATTERN_CHAT_CONFIG.clientId+'"'},contentType:"application/json; charset=utf-8",dataType:"json",type:"GET",url:n,crossDomain:!0,withCredentials:!0};e.ajax(t).done(function(e){h(e)})},h=function(n){var t="available"==n.chat,i=e("#sp-chat-widget");i.css("display","block"),e("#sp-chat-label-text").text(t?"Chat with us. We are online!":"Sorry. We are offline."),e("#sp-offline-label").css("display",t?"none":"block"),e("#sp-online-label").css("display",t?"block":"none"),t?(i.css("cursor","pointer"),i.bind("click",function(){a(!0)}),window.sessionStorage.getItem("sp-chat-snippet")&&a(!0)):(i.css("cursor","default"),i.unbind("click"),window.sessionStorage.removeItem("sp-chat-snippet"),setTimeout(m,5e3))},u=function(e,t){var i,o,a=e.length,s=0,d=document.getElementsByTagName("script")[0],c=function(e){e.onload=e.onreadystatechange=function(){return e.readyState&&"complete"!==e.readyState&&"loaded"!==e.readyState?!1:(e.onload=e.onreadystatechange=null,++s,void(a===s&&t()))},d.parentNode.insertBefore(e,d)},r=function(e){var t=document.createElement("script");t.async=!0,t.src=n.chatPath+e,c(t)};for(i=0,o=e.length;o>i;++i)r(e[i])};n.tenantUrl&&n.appId&&u(["js/json2.js","js/jquery-1.11.0.js"],function(){u(["js/jQuery.XDomainRequest.js","js/jquery-ui-1.11.1.js"],function(){e=jQuery.noConflict(!0),n.$=e,e.support.cors=!0,u(["js/chat-api-session.js"],function(){n.cp={url:n.apiUrl,crossDomain:!0,tenantUrl:n.tenantUrl,appId:n.appId,clientId:"WebChat",phoneNumber:n.phoneNumber,parameters:n.parameters,onFormShow:n.onFormShow,onAddStream:n.onAddStream,onAddLocalStream:n.onAddLocalStream},p()})})})}();